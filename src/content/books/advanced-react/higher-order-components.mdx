---
title: "ç°ä»£ä¸–ç•Œä¸­çš„é«˜é˜¶ç»„ä»¶"
description: "åœ¨è½¬å‘ React çš„å…¶ä»–éƒ¨åˆ†ä¹‹å‰ï¼Œè¿˜æœ‰ä¸€ç§æœ€ç»ˆçš„ç»„åˆæŠ€æœ¯éœ€è¦è®¨è®ºï¼šé«˜é˜¶ç»„ä»¶ï¼åœ¨ hooks å‡ºç°ä¹‹å‰ï¼Œè¿™æ˜¯å…±äº«çŠ¶æ€é€»è¾‘å’Œä¸Šä¸‹æ–‡æ•°æ®çš„æœ€æµè¡Œæ¨¡å¼ä¹‹ä¸€ã€‚å³ä½¿åœ¨ä»Šå¤©ï¼Œå®ƒä»ç„¶åœ¨ä¸€äº›æ—§åº“æˆ–åœ¨ hooks å‡ºç°ä¹‹å‰å¼€å§‹çš„é¡¹ç›®ä¸­ä½¿ç”¨ã€‚æ‰€ä»¥è™½ç„¶åœ¨æ–°ä»£ç ä¸­å¼•å…¥å®ƒä»¬å¯èƒ½ä¸æ˜¯æœ€å¥½çš„ä¸»æ„ï¼Œä½†ç†è§£å®ƒä»¬æ˜¯ä»€ä¹ˆä»¥åŠå®ƒä»¬æ˜¯å¦‚ä½•å·¥ä½œçš„ä»ç„¶æˆ–å¤šæˆ–å°‘æ˜¯å¼ºåˆ¶æ€§çš„ã€‚"

name: "higher-order-components"
---

æ‰€ä»¥è®©æˆ‘ä»¬ä»å¤´å¼€å§‹ï¼Œå­¦ä¹ çš„è¿‡ç¨‹åŒ…æ‹¬ï¼š

- ä»€ä¹ˆæ˜¯é«˜é˜¶ç»„ä»¶æ¨¡å¼ï¼Ÿ
- æˆ‘ä»¬å¦‚ä½•ä½¿ç”¨é«˜é˜¶ç»„ä»¶æ¥å¢å¼ºå›è°ƒå’Œ React ç”Ÿå‘½å‘¨æœŸäº‹ä»¶ï¼Ÿ
- å°†æ•°æ®ä¼ é€’ç»™é«˜é˜¶ç»„ä»¶çš„ä¸åŒæ–¹æ³•ã€‚
- å¦‚ä½•åˆ›å»ºå¯é‡ç”¨çš„ç»„ä»¶ï¼Œæ‹¦æˆª DOM å’Œé”®ç›˜äº‹ä»¶ã€‚

---

### ä»€ä¹ˆæ˜¯é«˜é˜¶ç»„ä»¶ï¼Ÿ

æ ¹æ® React æ–‡æ¡£ï¼Œé«˜é˜¶ç»„ä»¶æ˜¯ä¸€ç§é‡ç”¨ç»„ä»¶é€»è¾‘çš„é«˜çº§æŠ€æœ¯ï¼Œç”¨äºäº¤å‰å…³æ³¨ã€‚

ç®€å•æ¥è¯´ï¼Œå®ƒæ˜¯ä¸€ä¸ªæ¥å—ç»„ä»¶ä½œä¸ºå…¶å‚æ•°ä¹‹ä¸€çš„å‡½æ•°ï¼Œæ‰§è¡ŒæŸäº›é€»è¾‘ï¼Œç„¶åè¿”å›ä¸€ä¸ªæ¸²æŸ“å‚æ•°ä¸­ç»„ä»¶çš„å¦ä¸€ä¸ªç»„ä»¶ã€‚æœ€ç®€å•çš„å˜ä½“æ˜¯ä»€ä¹ˆéƒ½ä¸åšï¼š

```jsx
// æ¥å— Component ä½œä¸ºå‚æ•°
const withSomeLogic = (Component) => {
  // åšç‚¹ä»€ä¹ˆ
  // è¿”å›ä¸€ä¸ªæ ¹æ®å‚æ•°æ¸²æŸ“ç»„ä»¶çš„ç»„ä»¶;
  return (props) => <Component {...props} />;
};
```

å…³é”®åœ¨äºå‡½æ•°çš„è¿”å›éƒ¨åˆ†â€”â€”å®ƒåªæ˜¯ä¸€ä¸ªç»„ä»¶ï¼Œå’Œå…¶ä»–ä»»ä½•ç»„ä»¶ä¸€æ ·ã€‚

ç„¶åï¼Œå½“éœ€è¦ä½¿ç”¨å®ƒæ—¶ï¼Œå®ƒçœ‹èµ·æ¥æ˜¯è¿™æ ·çš„ï¼š

```jsx
// åªæ˜¯ä¸€ä¸ªæŒ‰é’®
const Button = ({ onClick }) => <button onClick={onClick}>Button</button>;
// ç›¸åŒçš„æŒ‰é’®ï¼Œä½†åŠŸèƒ½å¢å¼º
const ButtonWithSomeLogic = withSomeLogic(Button);
```

ä½ å°†ä½ çš„ Button ç»„ä»¶ä¼ é€’ç»™å‡½æ•°ï¼Œå®ƒè¿”å›ä¸€ä¸ªæ–°çš„ Buttonï¼Œå…¶ä¸­åŒ…å«åœ¨é«˜é˜¶ç»„ä»¶ä¸­å®šä¹‰çš„é€»è¾‘ã€‚ç„¶åè¿™ä¸ªæŒ‰é’®å¯ä»¥åƒå…¶ä»–æŒ‰é’®ä¸€æ ·ä½¿ç”¨ï¼š

```jsx
const SomePage = () => {
  return (
    <>
      <Button />
      <ButtonWithSomeLogic />
    </>
  );
};
```

æœ€ç®€å•å’Œæœ€å¸¸è§çš„ç”¨ä¾‹æ˜¯å‘ç»„ä»¶æ³¨å…¥ propsã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥å®ç°ä¸€ä¸ª withTheming ç»„ä»¶ï¼Œæå–ç½‘ç«™çš„å½“å‰ä¸»é¢˜ï¼ˆæ·±è‰²æˆ–äº®è‰²æ¨¡å¼ï¼‰å¹¶å°†è¯¥å€¼å‘é€åˆ° theme propã€‚å®ƒçœ‹èµ·æ¥åƒè¿™æ ·ï¼š

```jsx
const withTheme = (Component) => {
  // isDark å°†æ¥è‡ªç±»ä¼¼ context çš„å†…å®¹
  const theme = isDark ? "dark" : "light";
  // ç¡®ä¿æˆ‘ä»¬å°†æ‰€æœ‰ props éƒ½ä¼ é€’ç»™ç»„ä»¶
  // åŒæ—¶æ³¨å…¥æ–°çš„ä¸»é¢˜
  return (props) => <Component {...props} theme={theme} />;
};
```

ç°åœ¨ï¼Œå¦‚æœæˆ‘ä»¬åœ¨æŒ‰é’®ä¸Šä½¿ç”¨å®ƒï¼Œå®ƒå°†å…·æœ‰å¯ç”¨çš„ theme propï¼š

```jsx
const Button = ({ theme }) => {
 // theme prop å°†æ¥è‡ªä¸‹é¢çš„ withTheme HOC
 return <button className={theme} ...>Button</button>
}
const ButtonWithTheme = withTheme(Button);
```

<Callout icon="ğŸ”">
  [äº’åŠ¨ç¤ºä¾‹å’Œå®Œæ•´ä»£ç ](https://advanced-react.com/examples/07/01)
</Callout>

åœ¨ hooks å‡ºç°ä¹‹å‰ï¼Œé«˜é˜¶ç»„ä»¶è¢«å¹¿æ³›ç”¨äºè®¿é—®ä¸Šä¸‹æ–‡å’Œä»»ä½•å¤–éƒ¨æ•°æ®è®¢é˜…ã€‚ Redux çš„æ—§ connect æˆ– React Router çš„ withRouter å‡½æ•°éƒ½æ˜¯é«˜é˜¶ç»„ä»¶ï¼šå®ƒä»¬æ¥å—ä¸€ä¸ªç»„ä»¶ï¼Œå‘å…¶æ³¨å…¥ä¸€äº› propsï¼Œç„¶åè¿”å›å®ƒã€‚

æ­£å¦‚ä½ æ‰€çœ‹åˆ°çš„ï¼Œé«˜é˜¶ç»„ä»¶å†™èµ·æ¥ç›¸å½“å¤æ‚å¹¶ä¸”éš¾ä»¥ç†è§£ã€‚å› æ­¤ï¼Œå½“ hooks è¢«å¼•å…¥æ—¶ï¼Œå¤§å®¶è½¬å‘å®ƒä»¬ä¹Ÿå°±ä¸è¶³ä¸ºå¥‡äº†ã€‚

ç°åœ¨ï¼Œä¸å¿…åˆ›å»ºå¤æ‚çš„æ€ç»´å›¾æ¥å¼„æ¸…æ¥šå“ªä¸ª prop å»å“ªé‡Œï¼Œä»¥åŠä¸»é¢˜æ˜¯å¦‚ä½•è¿›å…¥ props çš„ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥å†™ï¼š

```jsx
const Button = () => {
 // æˆ‘ä»¬ç«‹å³çœ‹åˆ°ä¸»é¢˜çš„æ¥æº
 const { theme } = useTheme();
 return <button appearance={theme} ...>Button</button>
};
```

ç»„ä»¶ä¸­å‘ç”Ÿçš„æ‰€æœ‰äº‹æƒ…éƒ½å¯ä»¥ä»ä¸Šåˆ°ä¸‹è¯»å–ï¼Œæ‰€æœ‰æ•°æ®çš„æ¥æºéƒ½æ˜¯æ˜¾è€Œæ˜“è§çš„ï¼Œè¿™æ˜¾è‘—ç®€åŒ–äº†è°ƒè¯•å’Œå¼€å‘ã€‚

å°½ç®¡ hooks å¯èƒ½å·²ç»å–ä»£äº† 99% çš„å…±äº«é€»è¾‘å…³æ³¨å’Œ 100% çš„è®¿é—®ä¸Šä¸‹æ–‡çš„ç”¨ä¾‹ï¼Œä½†é«˜é˜¶ç»„ä»¶åœ¨ç°ä»£ä»£ç ä¸­ä»ç„¶å¯èƒ½æœ‰ç”¨ã€‚ä¸»è¦ç”¨äºå¢å¼ºå›è°ƒã€React ç”Ÿå‘½å‘¨æœŸäº‹ä»¶ï¼Œä»¥åŠæ‹¦æˆª DOM å’Œé”®ç›˜äº‹ä»¶ã€‚å½“ç„¶ï¼Œä»…å½“ä½ è§‰å¾—æœ‰è¶£çš„æ—¶å€™ã€‚è¿™äº›ç”¨ä¾‹ä¹Ÿå¯ä»¥é€šè¿‡ hooks å®ç°ï¼Œåªæ˜¯æ²¡æœ‰é‚£ä¹ˆä¼˜é›…ã€‚

è®©æˆ‘ä»¬æ¥çœ‹çœ‹å®ƒä»¬ã€‚

---

### å¢å¼ºå›è°ƒ

æƒ³è±¡ä¸€ä¸‹ï¼Œä½ éœ€è¦åœ¨æŸäº›å›è°ƒä¸­å‘é€ä¸€äº›é«˜çº§æ—¥å¿—ã€‚ä¾‹å¦‚ï¼Œå½“ä½ ç‚¹å‡»ä¸€ä¸ªæŒ‰é’®æ—¶ï¼Œä½ æƒ³å‘é€ä¸€äº›å¸¦æœ‰æ•°æ®çš„æ—¥å¿—äº‹ä»¶ã€‚ä½ ä¼šå¦‚ä½•ç”¨ hooks å®Œæˆå®ƒï¼Ÿä½ å¯èƒ½ä¼šæœ‰ä¸€ä¸ªå¸¦æœ‰ onClick å›è°ƒçš„ Button ç»„ä»¶ï¼š

```jsx
const Button = ({ onClick, children }) => {
  return <button onClick={onClick}>{children}</button>;
};
```

ç„¶ååœ¨æ¶ˆè´¹è€…ç«¯ï¼Œä½ ä¼šé’©å…¥é‚£ä¸ªå›è°ƒå¹¶åœ¨é‚£å‘é€æ—¥å¿—äº‹ä»¶ï¼š

```jsx
const SomePage = () => {
  const log = useLoggingSystem();
  const onClick = () => {
    log("Button was clicked");
  };
  return <Button onClick={onClick}>Click here</Button>;
};
```

å¦‚æœä½ æƒ³è§¦å‘ä¸€ä¸¤ä¸ªäº‹ä»¶ï¼Œè¿™å¾ˆå¥½ã€‚ä½†å¦‚æœä½ å¸Œæœ›åœ¨æ•´ä¸ªåº”ç”¨ä¸­æ¯æ¬¡æŒ‰é’®è¢«ç‚¹å‡»æ—¶éƒ½èƒ½ä¸€è‡´åœ°è§¦å‘æ—¥å¿—äº‹ä»¶å‘¢ï¼Ÿæˆ‘ä»¬å¯èƒ½å¯ä»¥å°†å…¶åµŒå…¥åˆ° Button ç»„ä»¶æœ¬èº«ä¸­ï¼š

```jsx
const Button = ({ onClick }) => {
  const log = useLoggingSystem();
  const onButtonClick = () => {
    log("Button was clicked");
    onClick();
  };
  return <button onClick={onButtonClick}>Click me</button>;
};
```

ä½†ç„¶åå‘¢ï¼Ÿä¸ºäº†è·å¾—æ­£ç¡®çš„æ—¥å¿—ï¼Œä½ è¿˜éœ€è¦å‘é€æŸç§æ•°æ®ã€‚æˆ‘ä»¬å½“ç„¶å¯ä»¥ç”¨ä¸€äº› loggingData props æ‰©å±• Button ç»„ä»¶å¹¶å‘ä¸‹ä¼ é€’ã€‚

```jsx
const Button = ({ onClick, loggingData }) => {
  const onButtonClick = () => {
    log("Button was clicked", loggingData);
    onClick();
  };
  return <button onClick={onButtonClick}>Click me</button>;
};
```

ä½†å¦‚æœä½ å¸Œæœ›åœ¨å…¶ä»–ç»„ä»¶ä¸Šå•å‡»æ—¶è§¦å‘ç›¸åŒçš„äº‹ä»¶å‘¢ï¼ŸæŒ‰é’®é€šå¸¸ä¸æ˜¯ç”¨æˆ·åœ¨åº”ç”¨ä¸­å¯ä»¥ç‚¹å‡»çš„å”¯ä¸€å…ƒç´ ã€‚å¦‚æœæˆ‘æƒ³åœ¨ ListItem ç»„ä»¶ä¸­æ·»åŠ ç›¸åŒçš„æ—¥å¿—ï¼Œæ˜¯å¦è¦å¤åˆ¶ç²˜è´´ç›¸åŒçš„é€»è¾‘ï¼Ÿ

```jsx
const ListItem = ({ onClick, loggingData }) => {
  const onListItemClick = () => {
    log("List item was clicked", loggingData);
    onClick();
  };
  return <Item onClick={onListItemClick}>Click me</Item>;
};
```

è¿™å¤ªå¤šçš„å¤åˆ¶ç²˜è´´ï¼Œå®¹æ˜“å‡ºé”™ï¼Œå¯èƒ½æœ‰äººä¼šå¿˜è®°æ›´æ”¹æŸäº›å†…å®¹ã€‚

æˆ‘æƒ³è¦çš„æœ¬è´¨ä¸Šæ˜¯å°†â€œæŸä¸ªäº‹ä»¶è§¦å‘ onClick å›è°ƒ - å‘é€ä¸€äº›æ—¥å¿—äº‹ä»¶â€çš„é€»è¾‘å°è£…åœ¨æŸä¸ªåœ°æ–¹ï¼Œç„¶ååœ¨æˆ‘æƒ³è¦çš„ä»»ä½•ç»„ä»¶ä¸­é‡ç”¨å®ƒï¼Œè€Œä¸æ”¹å˜é‚£äº›ç»„ä»¶çš„ä»£ç ã€‚

è¿™æ˜¯é«˜é˜¶ç»„ä»¶å¯ä»¥æ´¾ä¸Šç”¨åœºçš„ç¬¬ä¸€ä¸ªç”¨ä¾‹ï¼Œè€Œ hooks åˆ™æ— èƒ½ä¸ºåŠ›ã€‚

ä¸ºäº†é¿å…åœ¨æ¯ä¸ªåœ°æ–¹å¤åˆ¶ç²˜è´´â€œç‚¹å‡»å‘ç”Ÿ â†’ è®°å½•æ•°æ®â€çš„é€»è¾‘ï¼Œæˆ‘å¯ä»¥åˆ›å»ºä¸€ä¸ª `withLoggingOnClick` å‡½æ•°ï¼Œè¯¥å‡½æ•°ï¼š

- æ¥å—ä¸€ä¸ªç»„ä»¶ä½œä¸ºå‚æ•°ã€‚
- æ‹¦æˆªå…¶ `onClick` å›è°ƒã€‚
- å°†æˆ‘éœ€è¦çš„æ•°æ®å‘é€åˆ°ç”¨äºè®°å½•çš„ä»»ä½•å¤–éƒ¨æ¡†æ¶ã€‚
- è¿”å›å…·æœ‰åŸå§‹ `onClick` å›è°ƒçš„ç»„ä»¶ï¼Œä»¥ä¾¿è¿›ä¸€æ­¥ä½¿ç”¨ã€‚

å®ƒçœ‹èµ·æ¥åƒè¿™æ ·ï¼š

```jsx
// åªæ˜¯ä¸€ä¸ªæ¥å— Component ä½œä¸ºå‚æ•°çš„å‡½æ•°
export const withLoggingOnClick = (Component) => {
  return (props) => {
    const onClick = () => {
      console.log("Log on click something");
      // ä¸è¦å¿˜è®°è°ƒç”¨æ¥è‡ª props çš„ onClickï¼
      // æˆ‘ä»¬åœ¨ä¸‹é¢è¦†ç›–å®ƒ
      props.onClick();
    };
    // return åŸå§‹ç»„ä»¶å’Œæ‰€æœ‰ props
    // å¹¶ä½¿ç”¨æˆ‘ä»¬è‡ªå·±çš„å›è°ƒè¦†ç›– onClick
    return <Component {...props} onClick={onClick} />;
  };
};
```

ç°åœ¨ï¼Œæˆ‘å¯ä»¥å°†å…¶æ·»åŠ åˆ°ä»»ä½•æˆ‘æƒ³è¦çš„ç»„ä»¶ä¸­ã€‚æˆ‘å¯ä»¥æœ‰ä¸€ä¸ªå†…ç½®è®°å½•åŠŸèƒ½çš„æŒ‰é’®

```jsx
export const ButtonWithLoggingOnClick = withLoggingOnClick(SimpleButton);
```

æˆ–è€…åœ¨åˆ—è¡¨é¡¹ä¸­ä½¿ç”¨å®ƒ

```jsx
export const ListItemWithLoggingOnClick = withLoggingOnClick(ListItem);
```

æˆ–åœ¨ä»»ä½•å…¶ä»–æˆ‘æƒ³è·Ÿè¸ªçš„å…·æœ‰ `onClick` å›è°ƒçš„ç»„ä»¶ä¸­ã€‚ç”šè‡³ä¸éœ€è¦åœ¨ `Button` æˆ– `ListItem` ç»„ä»¶ä¸­æ›´æ”¹ä¸€è¡Œä»£ç ï¼

<Callout icon="ğŸ”">
  [äº’åŠ¨ç¤ºä¾‹å’Œå®Œæ•´ä»£ç ](https://advanced-react.com/examples/07/02)
</Callout>

---

### å‘é«˜é˜¶ç»„ä»¶æ·»åŠ æ•°æ®

ç°åœ¨ï¼Œå‰©ä¸‹çš„å°±æ˜¯ä»å¤–éƒ¨å‘è®°å½•å‡½æ•°æ·»åŠ ä¸€äº›æ•°æ®ã€‚è€ƒè™‘åˆ°é«˜é˜¶ç»„ä»¶åªä¸è¿‡æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“åšåˆ°è¿™ä¸€ç‚¹ã€‚æˆ‘ä»¬åªéœ€å‘å‡½æ•°æ·»åŠ ä¸€äº›å…¶ä»–å‚æ•°ï¼Œæ²¡åˆ«çš„ï¼š

```jsx
export const withLoggingOnClickWithParams = (
  Component,
  // æ·»åŠ ä¸€äº›å‚æ•°ä½œä¸ºå‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•°
  params,
) => {
  return (props) => {
    const onClick = () => {
      //è®¿é—®æˆ‘ä»¬åœ¨æ­¤å¤„ä½œä¸ºå‚æ•°ä¼ é€’çš„å‚æ•°
      // å…¶ä»–ä¸€åˆ‡éƒ½ä¿æŒä¸å˜
      console.log("Log on click: ", params.text);
      props.onClick();
    };
    return <Component {...props} onClick={onClick} />;
  };
};
```

ç°åœ¨ï¼Œå½“æˆ‘ä»¬ç”¨é«˜é˜¶ç»„ä»¶åŒ…è£…æŒ‰é’®æ—¶ï¼Œå¯ä»¥ä¼ é€’æˆ‘ä»¬æƒ³è¦è®°å½•çš„æ–‡æœ¬ï¼š

```jsx
const ButtonWithLoggingOnClickWithParams = withLoggingOnClickWithParams(
  SimpleButton,
  {
    text: "button component",
  },
);
```

åœ¨æ¶ˆè´¹è€…ç«¯ï¼Œæˆ‘ä»¬åªéœ€å°†è¿™ä¸ªæŒ‰é’®ç”¨ä½œæ™®é€šæŒ‰é’®ç»„ä»¶ï¼Œè€Œä¸å¿…æ‹…å¿ƒè®°å½•æ–‡æœ¬ï¼š

```jsx
const Page = () => {
  return (
    <ButtonWithLoggingOnClickWithParams onClick={onClickCallback}>
      Click me
    </ButtonWithLoggingOnClickWithParams>
  );
};
```

ä½†å¦‚æœæˆ‘ä»¬å®é™…æƒ³å…³æ³¨è¿™ä¸ªæ–‡æœ¬å‘¢ï¼Ÿå¦‚æœæˆ‘ä»¬å¸Œæœ›åœ¨æŒ‰é’®ä½¿ç”¨çš„ä¸åŒä¸Šä¸‹æ–‡ä¸­å‘é€ä¸åŒçš„æ–‡æœ¬å‘¢ï¼Ÿæˆ‘ä»¬ä¸æƒ³ä¸ºæ¯ä¸ªç”¨ä¾‹åˆ›å»ºä¸€ç™¾ä¸‡ä¸ªåŒ…è£…æŒ‰é’®ã€‚

è¿™ä¹Ÿå¾ˆå®¹æ˜“è§£å†³ï¼šæˆ‘ä»¬å¯ä»¥å°†æ–‡æœ¬ä½œä¸ºå±æ€§ä¼ é€’ç»™ç»“æœæŒ‰é’®ï¼Œè€Œä¸æ˜¯ä½œä¸ºå‡½æ•°å‚æ•°ä¼ é€’ã€‚ä»£ç çœ‹èµ·æ¥å¦‚ä¸‹ï¼š

```jsx
<ButtonWithLoggingOnClickWithProps
  onClick={onClickCallback}
  logText="this is Page button"
>
  Click me
</ButtonWithLoggingOnClickWithProps>
```

ç„¶åæˆ‘ä»¬å¯ä»¥ä»å‘é€åˆ°æŒ‰é’®çš„ props ä¸­æå– `logText`ï¼š

```jsx
export const withLoggingOnClickWithProps = (Component) => {
  // å®ƒä¼šåœ¨è¿™é‡Œçš„ props ä¸­ï¼Œè§£å‹å‡ºæ¥å°±è¡Œäº†
  return ({ logText, ...props }) => {
    const onClick = () => {
      //ç„¶åå°±åœ¨è¿™é‡Œä½¿ç”¨å®ƒ
      console.log("Log on click: ", logText);
      props.onClick();
    };
    return <Component {...props} onClick={onClick} />;
  };
};
```

<Callout icon="ğŸ”">
  [äº’åŠ¨ç¤ºä¾‹å’Œå®Œæ•´ä»£ç ](https://advanced-react.com/examples/07/03)
</Callout>

---

### å¢å¼º React ç”Ÿå‘½å‘¨æœŸäº‹ä»¶

æˆ‘ä»¬è¿™é‡Œå¹¶ä¸å±€é™äºç‚¹å‡»å’Œå›è°ƒã€‚è®°ä½ï¼Œè¿™äº›åªæ˜¯ç»„ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥åšä»»ä½•æˆ‘ä»¬æƒ³åšçš„äº‹æƒ…ã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ React æä¾›çš„ä¸€åˆ‡ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ç»„ä»¶æŒ‚è½½æ—¶å‘é€è¿™äº›æ—¥å¿—äº‹ä»¶

```jsx
export const withLoggingOnMount = (Component) => {
  return (props) => {
    // ä¸å†é‡å†™ onClick
    // ä½¿ç”¨æ™®é€šçš„ useEffect - å®ƒåªæ˜¯ä¸€ä¸ªç»„ä»¶!
    useEffect(() => {
      console.log("log on mount");
    }, []);
    // å¹¶å®Œæ•´åœ°ä¼ å› props
    return <Component {...props} />;
  };
};
```

æˆ–è€…åœ¨é‡æ–°æ¸²æŸ“æ—¶è¯»å– props å¹¶åœ¨æŸä¸ªç‰¹å®šçš„ prop å‘ç”Ÿå˜åŒ–æ—¶å‘é€å®ƒä»¬ï¼š

```jsx
export const withLoggingOnReRender = (Component) => {
  return ({ id, ...props }) => {
    // æ¯æ¬¡ â€œidâ€ å±æ€§æ›´æ”¹æ—¶è§¦å‘æ—¥å¿—è®°å½•
    useEffect(() => {
      console.log("log on id change");
    }, [id]);
    // å¹¶å®Œæ•´åœ°ä¼ å› props
    return <Component {...props} />;
  };
};
```

<Callout icon="ğŸ”">
  [äº’åŠ¨ç¤ºä¾‹å’Œå®Œæ•´ä»£ç ](https://advanced-react.com/examples/07/04)
</Callout>

---

### æ‹¦æˆª DOM äº‹ä»¶

é«˜é˜¶ç»„ä»¶çš„å¦ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„åº”ç”¨æ˜¯æ‹¦æˆªå„ç§ DOM å’Œé”®ç›˜äº‹ä»¶ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œä½ æ­£åœ¨ä¸ºé¡µé¢å®ç°æŸç§é”®ç›˜å¿«æ·é”®åŠŸèƒ½ã€‚å½“æŒ‰ä¸‹ç‰¹å®šæŒ‰é”®æ—¶ï¼Œä½ æƒ³åšå„ç§äº‹æƒ…ï¼Œæ¯”å¦‚æ‰“å¼€å¯¹è¯æ¡†ã€åˆ›å»ºé—®é¢˜ç­‰ã€‚ä½ å¯èƒ½ä¼šä¸ºæ­¤åœ¨çª—å£ä¸Šæ·»åŠ ä¸€ä¸ªäº‹ä»¶ç›‘å¬å™¨ï¼š

```jsx
useEffect(() => {
  const keyPressListener = (event) => {
    // åšäº‹
  };
  window.addEventListener("keypress", keyPressListener);
  return () => window.removeEventListener("keypress", keyPressListener);
}, []);
```

ç„¶åï¼Œä½ çš„åº”ç”¨ä¸­æœ‰å„ç§éƒ¨åˆ†ï¼Œæ¯”å¦‚æ¨¡æ€å¯¹è¯æ¡†ã€ä¸‹æ‹‰èœå•ã€æŠ½å±‰ç­‰ï¼Œä½ å¸Œæœ›åœ¨å¯¹è¯æ¡†æ‰“å¼€æ—¶é˜»æ­¢è¯¥å…¨å±€ç›‘å¬å™¨ã€‚å¦‚æœåªæœ‰ä¸€ä¸ªå¯¹è¯æ¡†ï¼Œä½ å¯ä»¥æ‰‹åŠ¨å°† `onKeyPress` æ·»åŠ åˆ°å¯¹è¯æ¡†æœ¬èº«ï¼Œå¹¶åœ¨é‚£é‡Œæ‰§è¡Œ `event.stopPropagation()`ï¼š

```jsx
export const Modal = ({ onClose }) => {
  const onKeyPress = (event) => event.stopPropagation();
  return <div onKeyPress={onKeyPress}>...// dialog code</div>;
};
```

ä½†å’Œ `onClick` è®°å½•çš„æƒ…å†µä¸€æ ·ï¼Œå¦‚æœä½ æœ‰å¤šä¸ªç»„ä»¶æƒ³è¦å®ç°è¿™ç§é€»è¾‘å‘¢ï¼Ÿåˆ°å¤„å¤åˆ¶ç²˜è´´ `event.stopPropagation`ï¼Ÿé‚£å¯ä¸è¡Œã€‚

æˆ‘ä»¬å¯ä»¥åšçš„æ˜¯ï¼Œå†æ¬¡å®ç°ä¸€ä¸ªé«˜é˜¶ç»„ä»¶ã€‚è¿™æ¬¡å®ƒå°†æ¥å—ä¸€ä¸ªç»„ä»¶ï¼Œå°†å…¶åŒ…è£…åœ¨ä¸€ä¸ªé™„åŠ  `onKeyPress` å›è°ƒçš„ div ä¸­ï¼Œå¹¶è¿”å›æœªæ›´æ”¹çš„ç»„ä»¶ã€‚

```jsx
export const withSuppressKeyPress = (Component) => {
  return (props) => {
    const onKeyPress = (event) => {
      event.stopPropagation();
    };
    return (
      <div onKeyPress={onKeyPress}>
        <Component {...props} />
      </div>
    );
  };
};
```

å°±è¿™æ ·ï¼ç°åœ¨æˆ‘ä»¬å¯ä»¥å°†ä»»ä½•ç»„ä»¶åŒ…è£…åœ¨å…¶ä¸­

```jsx
const ModalWithSuppressedKeyPress = withSuppressKeyPress(Modal);
const DropdownWithSuppressedKeyPress = withSuppressKeyPress(Dropdown);
// ç­‰
```

å¹¶åœ¨ä»»ä½•åœ°æ–¹ä½¿ç”¨å®ƒï¼š

```jsx
const Component = () => {
  return <ModalWithSuppressedKeyPress />;
};
```

ç°åœ¨ï¼Œå½“è¿™ä¸ªæ¨¡æ€æ‰“å¼€å¹¶è·å¾—ç„¦ç‚¹æ—¶ï¼Œä»»ä½•é”®æŒ‰äº‹ä»¶å°†é€šè¿‡å…ƒç´ å±‚æ¬¡ç»“æ„å†’æ³¡ï¼Œç›´åˆ°åˆ°è¾¾æˆ‘ä»¬åœ¨ `withSuppressKeyPress` ä¸­åŒ…è£…æ¨¡æ€çš„ divï¼Œå¹¶å°†åœ¨é‚£é‡Œåœæ­¢ã€‚

ä»»åŠ¡å®Œæˆï¼Œå¼€å‘äººå‘˜å®ç°æ¨¡æ€ç»„ä»¶æ—¶ç”šè‡³ä¸éœ€è¦çŸ¥é“æˆ–å…³å¿ƒè¿™ä¸€ç‚¹ã€‚

<Callout icon="ğŸ”">
  [äº’åŠ¨ç¤ºä¾‹å’Œå®Œæ•´ä»£ç ](https://advanced-react.com/examples/07/05)
</Callout>

---

### å…³é”®è¦ç‚¹

æˆ‘è®¤ä¸ºè¿™å·²ç»è¶³å¤Ÿæˆä¸ºä¹¦ä¸­çš„å†å²æ•™è®­ã€‚åœ¨æˆ‘ä»¬è·³åˆ°ä¸‹ä¸€ç« ä¹‹å‰ï¼Œæœ‰å‡ ä»¶äº‹æƒ…éœ€è¦è®°ä½ï¼Œè¿™ä¸€ç« æ¶‰åŠ React ä¸­æœ€ä»¤äººå…´å¥‹å’Œæœ€æœ‰äº‰è®®çš„éƒ¨åˆ†ï¼šçŠ¶æ€ç®¡ç†ï¼

- é«˜é˜¶ç»„ä»¶åªæ˜¯ä¸€ä¸ªæ¥å—ç»„ä»¶ä½œä¸ºå‚æ•°å¹¶è¿”å›æ–°ç»„ä»¶çš„å‡½æ•°ã€‚è¯¥æ–°ç»„ä»¶æ¸²æŸ“æ¥è‡ªå‚æ•°çš„ç»„ä»¶ã€‚

- æˆ‘ä»¬å¯ä»¥å°† props æˆ–é™„åŠ é€»è¾‘æ³¨å…¥åˆ°è¢«é«˜é˜¶ç»„ä»¶åŒ…è£…çš„ç»„ä»¶ä¸­ã€‚

  ```jsx
  //æ¥å— Component ä½œä¸ºå‚æ•°
  const withSomeLogic = (Component) => {
    // åœ¨è¿™é‡Œæ³¨å…¥ä¸€äº›é€»è¾‘
    // è¿”å›ä¸€ä¸ªæ ¹æ®å‚æ•°æ¸²æŸ“ç»„ä»¶çš„ç»„ä»¶;
    // å‘å…¶æ³¨å…¥ä¸€äº› prop
    return (props) => {
      // æˆ–è€…åœ¨è¿™é‡Œæ³¨å…¥ä¸€äº›é€»è¾‘
      // è¿™é‡Œå¯ä»¥ä½¿ç”¨ React hooksï¼Œå®ƒåªæ˜¯ä¸€ä¸ªç»„ä»¶
      return <Component {...props} some="data" />;
    };
  };
  ```

- æˆ‘ä»¬å¯ä»¥é€šè¿‡å‡½æ•°å‚æ•°æˆ– props å‘é«˜é˜¶ç»„ä»¶ä¼ é€’é™„åŠ æ•°æ®ã€‚
